import{q as H,r as m,h as I,o as r,c,e as T,l as C,n as P,b as l,i as E,t as N,F as S,a as n,m as x,_ as Q,g as W,u as X,s as Y,x as A,j as O,k as $,E as q,p as Z,d as ee}from"./index-8ba59db1.js";const te="/web/img/like.png",le="/web/img/share.png",oe=n("div",{class:"el-upload__tip"}," jpg/png 文件小于 500KB. ",-1),se=H({__name:"upload",emits:["uploadOk"],setup(w,{emit:B}){const f=B,L=()=>{f("uploadOk")};let a=m([]),p=!1;const V=v=>{console.log(v),console.log(a);let g=[];p=!0;for(let u=0;u<a.value.length;u++){var s=new FormData;s.append("file",a.value[u].raw);let k=x.post("/upload",s,{headers:{"Content-Type":"multipart/form-data"}});g.push(k)}Promise.all(g).then(u=>{console.log("ok"),console.log(u),p=!1,a.value=[],L()}).catch(u=>{console.log(u),p=!1})};return(v,g)=>{const s=I("el-button"),u=I("el-upload");return r(),c(S,null,[T(u,{ref:"upload","list-type":"picture","file-list":l(a),"onUpdate:fileList":g[0]||(g[0]=k=>E(a)?a.value=k:a=k),class:"upload-demo",action:"",multiple:"",limit:30,"auto-upload":!1},{tip:C(()=>[oe]),default:C(()=>[T(s,{type:"primary"},{default:C(()=>[P("选择文件")]),_:1})]),_:1},8,["file-list"]),T(s,{type:"primary",onClick:V,disabled:l(p)},{default:C(()=>[P(N(l(p)?"上传中":"上传"),1)]),_:1},8,["disabled"])],64)}}});const ae=w=>(Z("data-v-113062e9"),w=w(),ee(),w),ne={id:"wwlist"},ie={id:"wwBox"},re=["onClick"],ue=["src"],de=["src"],pe=["onClick"],ce=ae(()=>n("img",{src:le},null,-1)),ge={__name:"lst",props:["page","search"],setup(w,{expose:B}){let f=w,L=W();X();let a=m([]),p=window.isAdmin;const V={}.APP_BASE_URL||document.location.origin+"/";let v=o=>{console.log(f.search);let e="/goods";f.search&&(e+=`?search=${f.search}`),x.get(e).then(i=>{var _;if(a.value=(_=i.data)==null?void 0:_.data,f.page==="me"){let U=JSON.parse(localStorage.getItem("likeList")),t=[];U.map(h=>{let d=a.value.find(z=>z._id===h._id);d&&t.push(d)}),a.value=t}})};v(),console.log(L),console.log(L.query.searchVal),m(L.query.searchVal),Y(f.search,o=>{console.log(o)});let g=m([]),s=m(null),u=o=>{console.log(o),s.value=o,b.value=o.tags||[],D()},k=o=>{s.value=null};(async o=>{let e=await x.get("/tags");g.value=e.data.data})();let j=o=>{v()},b=m([]),G=o=>{b.value.splice(o,1),D()},K=async(o,e)=>{console.log(o),o.stopPropagation(),o.preventDefault();let i=await x.delete("/goods",{data:e});console.log(i),v()},J=o=>{let e=localStorage.getItem("likeList");e=JSON.parse(e);let i=e.findIndex(_=>_._id===s.value._id);console.log(i),i==-1?(e.push(s.value),localStorage.setItem("likeList",JSON.stringify(e)),q({message:"收藏成功",type:"success"})):(q({message:"已取消收藏",type:"success"}),e.splice(i,1),localStorage.setItem("likeList",JSON.stringify(e)))},R=m([]),D=o=>{R.value=g.value.filter(e=>{let i=b.value.find(_=>_==e.tag);return console.log(i),!i})},y=m(!1),M=o=>{b.value.push(o.tag),D()},F=async o=>{s.value.tags=b.value;let e=await x.put("/goods",s.value);console.log(e),q({type:"success",message:"保存成功"})};return B({refrushPage:v}),(o,e)=>{const i=I("el-popconfirm"),_=I("el-button"),U=I("el-dialog");return r(),c(S,null,[n("div",ne,[n("div",ie,[l(p)?(r(),A(se,{key:0,onUploadOk:l(j)},null,8,["onUploadOk"])):O("",!0),(r(!0),c(S,null,$(l(a),(t,h)=>(r(),c("button",{onClick:d=>l(u)(t)},[n("img",{src:`${l(V)}static/${t.url}`},null,8,ue),l(p)?(r(),A(i,{key:0,title:"Are you sure to delete this?",onConfirm:d=>l(K)(d,t)},{reference:C(()=>[n("button",{class:"delete",onClick:e[0]||(e[0]=d=>{d.stopPropagation(),d.preventDefault()})},"删除")]),_:2},1032,["onConfirm"])):O("",!0)],8,re))),256))]),l(s)?(r(),c("div",{key:0,id:"details",onClick:e[6]||(e[6]=(...t)=>l(k)&&l(k)(...t))},[n("img",{src:`${l(V)}static/${l(s).url}`},null,8,de),l(p)?(r(),c("div",{key:0,class:"handle",onClick:e[3]||(e[3]=t=>{t.stopPropagation(),t.preventDefault()})},[n("div",{onClick:e[1]||(e[1]=t=>{console.log(t),E(y)?y.value=!0:y=!0})},"+"),(r(!0),c(S,null,$(l(b),(t,h)=>(r(),c("div",{key:h},[P(N(t)+" ",1),n("button",{onClick:d=>l(G)(h)},"-",8,pe)]))),128)),n("div",{onClick:e[2]||(e[2]=(...t)=>l(F)&&l(F)(...t))},"保存")])):O("",!0),n("div",{id:"handlebar",onClick:e[5]||(e[5]=t=>{t.stopPropagation(),t.preventDefault()})},[ce,n("img",{src:te,onClick:e[4]||(e[4]=(...t)=>l(J)&&l(J)(...t))}),n("span",null,N(l(s).name),1)])])):O("",!0)]),T(U,{modelValue:l(y),"onUpdate:modelValue":e[7]||(e[7]=t=>E(y)?y.value=t:y=t),title:"添加标签"},{default:C(()=>[(r(!0),c(S,null,$(l(R),(t,h)=>(r(),A(_,{key:h,onClick:d=>l(M)(t)},{default:C(()=>[P(N(t.tag),1)]),_:2},1032,["onClick"]))),128))]),_:1},8,["modelValue"])],64)}}},fe=Q(ge,[["__scopeId","data-v-113062e9"]]);export{fe as L,te as _};
