import{q as M,r as _,h as T,o as u,c as p,e as I,l as v,n as B,b as l,i as q,t as P,F as V,a,m as x,_ as z,g as H,u as Q,s as F,j as U,k as A,E as W,p as X,d as Y}from"./index-3c3dad4c.js";const Z="/web/img/like.png",ee="/web/img/share.png",te=a("div",{class:"el-upload__tip"}," jpg/png 文件小于 500KB. ",-1),le=M({__name:"upload",emits:["uploadOk"],setup(k,{emit:D}){const w=D,y=()=>{w("uploadOk")};let i=_([]),c=!1;const b=h=>{console.log(h),console.log(i);let s=[];c=!0;for(let n=0;n<i.value.length;n++){var m=new FormData;m.append("file",i.value[n].raw);let L=x.post("//upload",m,{headers:{"Content-Type":"multipart/form-data"}});s.push(L)}Promise.all(s).then(n=>{console.log("ok"),console.log(n),c=!1,i.value=[],y()}).catch(n=>{console.log(n),c=!1})};return(h,s)=>{const m=T("el-button"),n=T("el-upload");return u(),p(V,null,[I(n,{ref:"upload","list-type":"picture","file-list":l(i),"onUpdate:fileList":s[0]||(s[0]=L=>q(i)?i.value=L:i=L),class:"upload-demo",action:"",multiple:"",limit:30,"auto-upload":!1},{tip:v(()=>[te]),default:v(()=>[I(m,{type:"primary"},{default:v(()=>[B("选择文件")]),_:1})]),_:1},8,["file-list"]),I(m,{type:"primary",onClick:b,disabled:l(c)},{default:v(()=>[B(P(l(c)?"上传中":"上传"),1)]),_:1},8,["disabled"])],64)}}});const oe=k=>(X("data-v-e2a5c551"),k=k(),Y(),k),se={id:"wwlist"},ae={id:"wwBox"},ne=["onClick"],ie=["src"],ue=["src"],re=["onClick"],de=oe(()=>a("img",{src:ee},null,-1)),pe={__name:"lst",props:["page"],setup(k){let D=k,w=H();Q();let y=_([]),i=window.isAdmin;const c={}.APP_BASE_URL||document.location.origin+"/";let b=o=>{x.get("/goods").then(e=>{var r;if(y.value=(r=e.data)==null?void 0:r.data,D.page==="me"){let S=JSON.parse(localStorage.getItem("likeList")),O=[];S.map(t=>{let g=y.value.find(d=>d._id===t._id);g&&O.push(g)}),y.value=O}})};b(),console.log(w),console.log(w.query.searchVal),_(w.query.searchVal);let h=_([]),s=_(null),m=o=>{console.log(o),s.value=o,C.value=o.tags||[],N()},n=o=>{s.value=null};(async o=>{let e=await x.get("/tags");h.value=e.data.data})();let J=o=>{b()},C=_([]),j=o=>{C.value.splice(o,1),N()},G=async(o,e)=>{console.log(o),o.stopPropagation(),o.preventDefault();let r=await x.delete("/goods",{data:e});console.log(r),b()},E=o=>{let e=localStorage.getItem("likeList");e=JSON.parse(e),e.push(s.value),localStorage.setItem("likeList",JSON.stringify(e))},R=_([]),N=o=>{R.value=h.value.filter(e=>{let r=C.value.find(S=>S==e.tag);return console.log(r),!r})},f=_(!1),K=o=>{C.value.push(o.tag),N()},$=async o=>{s.value.tags=C.value;let e=await x.put("/goods",s.value);console.log(e),W({type:"success",message:"保存成功"})};return(o,e)=>{const r=T("el-popconfirm"),S=T("el-button"),O=T("el-dialog");return u(),p(V,null,[a("div",se,[a("div",ae,[l(i)?(u(),F(le,{key:0,onUploadOk:l(J)},null,8,["onUploadOk"])):U("",!0),(u(!0),p(V,null,A(l(y),(t,g)=>(u(),p("button",{onClick:d=>l(m)(t)},[a("img",{src:`${l(c)}static/${t.url}`},null,8,ie),I(r,{title:"Are you sure to delete this?",onConfirm:d=>l(G)(d,t)},{reference:v(()=>[a("button",{class:"delete",onClick:e[0]||(e[0]=d=>{d.stopPropagation(),d.preventDefault()})},"删除")]),_:2},1032,["onConfirm"])],8,ne))),256))]),l(s)?(u(),p("div",{key:0,id:"details",onClick:e[6]||(e[6]=(...t)=>l(n)&&l(n)(...t))},[a("img",{src:`${l(c)}static/${l(s).url}`},null,8,ue),l(i)?(u(),p("div",{key:0,class:"handle",onClick:e[3]||(e[3]=t=>{t.stopPropagation(),t.preventDefault()})},[a("div",{onClick:e[1]||(e[1]=t=>{console.log(t),q(f)?f.value=!0:f=!0})},"+"),(u(!0),p(V,null,A(l(C),(t,g)=>(u(),p("div",{key:g},[B(P(t)+" ",1),a("button",{onClick:d=>l(j)(g)},"-",8,re)]))),128)),a("div",{onClick:e[2]||(e[2]=(...t)=>l($)&&l($)(...t))},"保存")])):U("",!0),a("div",{id:"handlebar",onClick:e[5]||(e[5]=t=>{t.stopPropagation(),t.preventDefault()})},[de,a("img",{src:Z,onClick:e[4]||(e[4]=(...t)=>l(E)&&l(E)(...t))}),a("span",null,P(l(s).name),1)])])):U("",!0)]),I(O,{modelValue:l(f),"onUpdate:modelValue":e[7]||(e[7]=t=>q(f)?f.value=t:f=t),title:"添加标签"},{default:v(()=>[(u(!0),p(V,null,A(l(R),(t,g)=>(u(),F(S,{key:g,onClick:d=>l(K)(t)},{default:v(()=>[B(P(t.tag),1)]),_:2},1032,["onClick"]))),128))]),_:1},8,["modelValue"])],64)}}},ge=z(pe,[["__scopeId","data-v-e2a5c551"]]);export{ge as L,Z as _};
